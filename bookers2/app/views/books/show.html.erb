<p class="notice text-success" >
  <%= flash[:notice] %>
</p>
<div class= "container px-5 px-sm-0">
  <div class= "row">
    <div class= "col-md-3">
      <%= render 'books/userinfo', book: Book.new, user: @user %>
    </div>

    <div class= "col-md-8 offset-md-1">
      <h2>Book detail</h2>
        <table class= "table table-hover table-inverse">
          <tbody>

            <tr>
              <td>
                <%= link_to user_path(@book.user) do %>
                  <%= attachment_image_tag @book.user, :profile_image, size: "40x40", format: 'jpeg', fallback: "no_image.jpg" %><br>
                <% end %>
                <%= link_to @book.user.name, user_path(@book.user) %>
              </td>
              <td><%= link_to @book.title, book_path(@book) %></td>
              <td><%= @book.body %></td>
              <% if @book.favorited_by?(current_user) %>
                <td>
                <%= link_to book_favorites_path(@book), method: :delete do %>
                  ♥<%= @book.favorites.count %>
                <% end %>
                </td>
              <% else %>
                <td>
                  <%= link_to book_favorites_path(@book), method: :post do %>
                    ♡<%= @book.favorites.count %>
                  <% end %>
                </td>
              <% end %>
              <td>コメント数: <%= @book.post_comments.count %></td>
              <% if @user == current_user %>
              <td><%= link_to "Edit", edit_book_path(@book), class: 'btn btn-sm btn-success' %></td>
              <td><%= link_to 'Destroy',book_path(@book), method: :delete,"data-confirm" => "本当に消しますか？",class:'btn btn-sm btn-danger' %></td>
              <% end %>
            </tr>
          </tbody>
        </table>

        <% @book.post_comments.each do |post_comment| %>
        <div>
          <%= link_to user_path(post_comment.user) do %>
            <%= attachment_image_tag post_comment.user, :profile_image, size: "40x40", format: 'jpeg', fallback: "no_image.jpg" %>
          <% end %>
          <%= post_comment.comment %>
          <% if post_comment.user == current_user %>
            <%= link_to 'Destroy',book_post_comment_path(post_comment.book, post_comment), method: :delete,"data-confirm" => "本当に消しますか？",class:'btn btn-sm btn-danger' %>
          <% end %><br>
          <%= link_to post_comment.user.name, user_path(post_comment.user) %>
        <% end %>

        <%= form_with(model:[@book, @post_comment], local: true) do |f| %>
          <%= f.text_area :comment, class: "form-control" %><br>
          <%= f.submit "送信" %>
        </div>
        <% end %>
    </div>
  </div>
</div>